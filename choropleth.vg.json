{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Smoking Prevalence in Australia",
    "vconcat": [
        {
            "width": 800,
            "height": 450,
            "projection": {
                "type": "mercator",
                "center": [134, -10],
                "scale": 650},
            "params": [ 
                {
                    "name": "stateSelect",
                    "select": {"type": "point", "fields": ["State"]}
                }
            ],
            "data": {
                "url": "https://raw.githubusercontent.com/IlyasHasyim/FIT3179_Vis2_Repository/refs/heads/main/data/STE_2016_AUST.json",
                "format": {"type": "topojson", "feature": "STE_2016_AUST"}
            },
            "transform": [
                {
                    "lookup": "properties.STE_NAME16",
                    "from": {
                        "data":{
                            "url": "https://raw.githubusercontent.com/IlyasHasyim/FIT3179_Vis2_Repository/refs/heads/main/data/Dataset.csv"
                        },
                        "key": "State",
                        "fields": ["% of daily smokers", "Current daily smoker", "Life Expectancy"]
                    }
                },
                {"calculate": "datum.properties.STE_NAME16", "as": "State"}
            ],
            "mark": {"type": "geoshape", "stroke": "white"},
            "encoding": {
                "color": {
                    "field": "% of daily smokers",
                    "type": "quantitative",
                    "scale": {"scheme":"reds"},
                    "title": "% of daily smokers",
                    "legend": {
                        "labelExpr": "datum.label + '%'"
                    }
                },
                "opacity":{
                    "condition": {"param": "stateSelect", "value": 1},
                    "value": 0.5
                },

                "tooltip": [
                    {"field": "properties.STE_NAME16", "type": "nominal", "title": "State"},
                    {"field": "% of daily smokers", "type": "quantitative", "title": "% of daily smokers"},
                    {"field": "Current daily smoker", "type": "quantitative", "title": "Number of daily smokers"},
                    {"field": "Life Expectancy", "type": "quantitative", "title": "Life Expectancy"}
                ]
            }
        },

        {
            "width": 800,
            "height": 300,
            "title": "Life Expectancy of Each State",
            "data": {
                "url": "https://raw.githubusercontent.com/IlyasHasyim/FIT3179_Vis2_Repository/refs/heads/main/data/Dataset.csv"
            },
            "transform": [
                {"filter": {"param": "stateSelect"}}
            ],
            "layer": [
                {
                    "mark": {"type": "point", 
                    "filled": true
                    },
                    "encoding": {
                        "x": {"field": "% of daily smokers", "type": "quantitative", "scale": {"domain": [5, 15]}},
                        "y": {"field": "Life Expectancy", "type": "quantitative", "scale": {"domain": [77, 85]}},
                        "color":{
                            "field": "State",
                            "type": "nominal",
                            "legend": {"orient": "right"},
                            "scale": {"scheme": "purplered"}
                        },
                        "size": {
                            "field": "% of daily smokers",
                            "type": "quantitative",
                            "scale": 
                            {
                                "domain": [5, 15],
                                "range": [50, 1500]
                            },
                            "title": "% of daily smokers"
                        },
                        "tooltip": [
                            {"field": "State", "type": "nominal"},
                            {"field": "% of daily smokers", "type": "quantitative", "title": "% of daily smokers"},
                            {"field": "Life Expectancy", "type": "quantitative", "title": "Life Expectancy"}
                        ]
                    }
                },
                {
                    "mark": {"type": "rule", "color": "red", "strokeWidth": 1},
                    "encoding": {
                        "y": {"datum": 83}
                    }
                }
            ]
        }
    ]
}